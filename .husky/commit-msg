# JIRA ticket prefix variable
JIRA_PREFIX="TN"

message=$(cat "$1")
commit_regex="^(feat|fix|docs|style|refactor|perf|test|chore)(\(\S+\))?: \S+" # feat: add login feature
jira_regex="${JIRA_PREFIX}-[0-9]{1,5}" # feat: ${JIRA_PREFIX}-1234 add login feature

# Apple Conventional Message regex
if ! echo "$message" | egrep -q "$commit_regex"; then
  echo "ERROR: Commit message does not follow Conventional Commits format!"
  echo "Valid types are: feat, fix, docs, style, refactor, perf, test, chore."
  echo "Example: feat(auth): add login feature"
  exit 1
fi

# Apply Jira ticket requirement regex
if ! echo "$message" | egrep -q "$jira_regex"; then
  echo "ERROR: JIRA Ticket ID is required at the beginning of the commit message right after the convention!"
  echo "Example: feat(auth): ${JIRA_PREFIX}1234 add login feature"
  exit 1
fi

# Check if there's a body message separated by a blank line
if ! echo "$message" | awk 'NF==0 { blank=1 } blank && NF { print; exit }' | grep -q .; then
  echo "ERROR: Commit message must include a description of what has been done!"
  exit 1
fi